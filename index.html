<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>2048 for fun</title>
<style>
  body { background: #faf8ef; font-family: Arial, sans-serif; text-align: center; }
  #header { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px; }
  .score-box {
    background: #bbada0; color: #fff; padding: 10px 20px;
    border-radius: 5px; font-weight: bold; font-size: 18px;
  }
  #game-container {
    width: 90vw; max-width: 400px; height: 90vw; max-height: 400px;
    background: #bbada0; margin: 20px auto; display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: 10px; padding: 10px; border-radius: 10px; position: relative;
  }
  .tile { border-radius: 5px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 24px; position: relative; }
  .tile img { max-width: 80%; max-height: 80%; border-radius: 5px; }
  .tile .value-label {
    position: absolute; top: 5px; left: 5px; font-size: 14px;
    background: rgba(255,255,255,0.5); padding: 2px 5px; border-radius: 3px; pointer-events: none;
  }
  #overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(238,228,218,0.8); display: flex; justify-content: center; align-items: center;
    font-size: 32px; font-weight: bold; color: #776e65; display: none; border-radius: 10px;
    flex-direction: column; gap: 10px; z-index: 10;
  }
  button {
    padding: 10px 20px; font-size: 16px; border-radius: 5px; border: none; cursor: pointer;
    margin-top: 10px; background: #8f7a66; color: white;
  }
  button:hover { background: #9f8b77; }
  #mobile-controls { margin-top: 10px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
</style>
</head>
<body>

<h1>2048</h1>
<div id="header">
  <button onclick="restartGame()">Начать заново</button>
  <div id="score" class="score-box">Счёт: 0</div>
  <div id="best" class="score-box">Рекорд: 0</div>
</div>

<div id="game-container">
  <div id="overlay">
    <div>Игра окончена!</div>
    <div id="final-score">Ваш счёт: 0</div>
    <div id="final-best">Рекорд: 0</div>
    <button onclick="restartGame()">Сыграть ещё</button>
  </div>
</div>

<div id="mobile-controls">
  <button onclick="move('up')">↑</button>
  <button onclick="move('left')">←</button>
  <button onclick="move('down')">↓</button>
  <button onclick="move('right')">→</button>
</div>

<script>
const size=4;
let grid=[], score=0, bestScore=parseInt(localStorage.getItem("bestScore"))||0;

const images={2:"img2.png",4:"img4.png",8:"img8.png",16:"img16.png",32:"img32.png",
64:"img64.png",128:"img128.png",256:"img256.png",512:"img512.png",1024:"img1024.png",2048:"img2048.png"};
const colors={2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",
64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"};

function getImage(v){return images[v]||"";}
function getColor(v){return colors[v]||"#3c3a32";}
function getLabelColor(v){return v<=4?"#776e65":"#fff";}

function updateScore(points){score+=points;
if(score>bestScore){bestScore=score; localStorage.setItem("bestScore",bestScore);}
document.getElementById("score").textContent="Счёт: "+score;
document.getElementById("best").textContent="Рекорд: "+bestScore;}

function initGrid(){grid=Array(size).fill(null).map(()=>Array(size).fill(0));
score=0; updateScore(0); addRandomTile(); addRandomTile(); render(); hideGameOver();}

function addRandomTile(){const empty=[];for(let i=0;i<size;i++){for(let j=0;j<size;j++){if(grid[i][j]===0) empty.push({i,j});}}
if(empty.length){const {i,j}=empty[Math.floor(Math.random()*empty.length)]; grid[i][j]=Math.random()<0.9?2:4;}}

function render(){
const container=document.getElementById("game-container");
const overlay=document.getElementById("overlay");
container.innerHTML=""; container.appendChild(overlay);

for(let i=0;i<size;i++){for(let j=0;j<size;j++){
const tile=document.createElement("div"); tile.className="tile"; const value=grid[i][j];
tile.style.backgroundColor=getColor(value);
if(value){const img=document.createElement("img"); img.src=getImage(value); img.alt=value; tile.appendChild(img);
const label=document.createElement("div"); label.className="value-label"; label.textContent=value;
label.style.color=getLabelColor(value); tile.appendChild(label);}
container.appendChild(tile);}}}

function slide(row){let arr=row.filter(v=>v!==0); for(let i=0;i<arr.length-1;i++){if(arr[i]===arr[i+1]){arr[i]*=2; updateScore(arr[i]); arr[i+1]=0;}} arr=arr.filter(v=>v!==0); while(arr.length<size) arr.push(0); return arr;}
function moveLeft(){let moved=false; for(let i=0;i<size;i++){const newRow=slide(grid[i]); if(grid[i].toString()!==newRow.toString()) moved=true; grid[i]=newRow;} return moved;}
function moveRight(){let moved=false; for(let i=0;i<size;i++){const newRow=slide(grid[i].slice().reverse()).reverse(); if(grid[i].toString()!==newRow.toString()) moved=true; grid[i]=newRow;} return moved;}
function moveUp(){let moved=false; for(let j=0;j<size;j++){let col=[]; for(let i=0;i<size;i++) col.push(grid[i][j]); const newCol=slide(col); for(let i=0;i<size;i++){if(grid[i][j]!==newCol[i]) moved=true; grid[i][j]=newCol[i];}} return moved;}
function moveDown(){let moved=false; for(let j=0;j<size;j++){let col=[]; for(let i=0;i<size;i++) col.push(grid[i][j]); const newCol=slide(col.reverse()).reverse(); for(let i=0;i<size;i++){if(grid[i][j]!==newCol[i]) moved=true; grid[i][j]=newCol[i];}} return moved;}

function isGameOver(){for(let i=0;i<size;i++){for(let j=0;j<size;j++){
if(grid[i][j]===0) return false; if(j<size-1 && grid[i][j]===grid[i][j+1]) return false;
if(i<size-1 && grid[i][j]===grid[i+1][j]) return false;}} return true;}
function showGameOver(){document.getElementById("final-score").textContent="Ваш счёт: "+score;
document.getElementById("final-best").textContent="Рекорд: "+bestScore; document.getElementById("overlay").style.display="flex";}
function hideGameOver(){document.getElementById("overlay").style.display="none";}
function restartGame(){initGrid();}

function move(dir){let moved=false; switch(dir){case 'up': moved=moveUp(); break; case 'down': moved=moveDown(); break; case 'left': moved=moveLeft(); break; case 'right': moved=moveRight(); break;} 
if(moved){addRandomTile(); render(); if(isGameOver()) showGameOver();}}

document.addEventListener("keydown", e=>{let moved=false; switch(e.key){case "ArrowLeft": moved=moveLeft(); break;
case "ArrowRight": moved=moveRight(); break; case "ArrowUp": moved=moveUp(); break; case "ArrowDown": moved=moveDown(); break;}
if(moved){addRandomTile(); render(); if(isGameOver()) showGameOver();}});

// свайпы для мобильных
let touchStartX=0, touchStartY=0;
document.addEventListener('touchstart', e=>{ const touch=e.touches[0]; touchStartX=touch.clientX; touchStartY=touch.clientY; });
document.addEventListener('touchend', e=>{ const touch=e.changedTouches[0]; const dx=touch.clientX-touchStartX; const dy=touch.clientY-touchStartY;
if(Math.abs(dx)>Math.abs(dy)){ if(dx>30) move('right'); else if(dx<-30) move('left'); } else { if(dy>30) move('down'); else if(dy<-30) move('up'); }});

initGrid();
</script>
</body>
</html>
